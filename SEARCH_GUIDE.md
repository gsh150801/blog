# 全文搜索功能指南

## 概述

极简博客v2.2.0版本新增了强大的全文搜索功能，支持文章标题和内容的快速搜索，提供智能搜索建议、搜索历史记录和多维度排序等功能。

## 核心功能

### 1. 全文搜索

#### 搜索能力
- 支持文章标题搜索
- 支持文章内容全文搜索
- 支持中文和英文搜索
- 支持多关键词搜索
- 不区分大小写

#### 搜索入口
- **导航栏搜索框**: 在页面顶部导航栏中
- **快捷键**: `Ctrl+K` (Windows/Linux) 或 `Cmd+K` (Mac)
- **移动端**: 点击菜单后显示搜索框

### 2. 搜索结果高亮

#### 高亮显示
- 搜索关键词自动高亮
- 标题中的关键词高亮
- 摘要中的关键词高亮
- 支持多个关键词同时高亮
- 淡蓝色背景标记

#### 摘要提取
- 智能提取包含关键词的上下文
- 摘要长度约200字符
- 关键词居中显示
- 自动添加省略号

### 3. 搜索历史

#### 历史记录
- 自动保存最近20条搜索记录
- 使用localStorage本地存储
- 搜索记录自动去重
- 按时间倒序排列

#### 历史管理
- 点击历史记录快速搜索
- 一键清除所有历史
- 自动清理超出数量的记录

### 4. 搜索建议

#### 实时建议
- 基于文章标题的自动补全
- 输入2个字符后开始显示建议
- 最多显示5条建议
- 防抖优化（300ms）

#### 建议交互
- 点击建议直接搜索
- 键盘上下箭头浏览
- Enter键确认选择
- ESC键关闭建议框

### 5. 多维度排序

#### 排序选项
- **相关性排序**: 根据关键词匹配度排序（默认）
- **发布时间排序**: 按文章发布时间倒序
- **浏览量排序**: 按文章浏览量倒序

#### 相关性算法
- 标题匹配: 每个关键词+10分
- 内容匹配: 每次匹配+1分
- 综合评分排序

## 使用指南

### 基础搜索

1. **打开搜索框**
   - 点击导航栏搜索框
   - 或按 `Ctrl+K` / `Cmd+K`

2. **输入关键词**
   - 输入要搜索的关键词
   - 支持多个关键词（空格分隔）

3. **查看建议**
   - 输入时自动显示搜索建议
   - 查看搜索历史记录

4. **执行搜索**
   - 按 `Enter` 键搜索
   - 或点击建议项直接搜索

### 高级搜索技巧

#### 多关键词搜索
```
React TypeScript
```
搜索同时包含"React"和"TypeScript"的文章

#### 精确短语搜索
虽然系统会匹配所有关键词，但标题完全匹配的文章排名更高

#### 使用搜索历史
- 点击搜索框查看历史记录
- 点击历史记录快速重复搜索
- 定期清理不需要的历史

## 搜索结果页面

### 页面结构

#### 搜索头部
- 显示搜索关键词
- 显示搜索结果数量
- 排序选项按钮

#### 结果列表
每个搜索结果包含：
- 高亮的文章标题
- 发布日期
- 浏览量
- 相关度评分（相关性排序时）
- 高亮的文章摘要

#### 无结果提示
- 友好的无结果说明
- 建议尝试其他关键词
- 快速跳转到文章列表

### 排序切换

点击排序按钮切换：
- **相关性**: 最匹配的文章优先
- **发布时间**: 最新文章优先
- **浏览量**: 最热门文章优先

## 快捷键参考

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+K` / `Cmd+K` | 打开搜索框 |
| `↑` | 上一个建议 |
| `↓` | 下一个建议 |
| `Enter` | 确认搜索 |
| `ESC` | 关闭建议框 |

## 技术架构

### 前端组件

#### SearchBox组件
```typescript
<SearchBox 
  onSearch={(query) => navigate(`/search?q=${query}`)}
  suggestions={suggestions}
  showSuggestions={true}
/>
```

特性：
- 实时搜索建议
- 搜索历史管理
- 键盘导航
- 全局快捷键

#### SearchResults页面
路由: `/search?q=关键词`

功能：
- 显示搜索结果
- 关键词高亮
- 多维度排序
- 分页（未来扩展）

### 搜索Hook

#### useSearch Hook
```typescript
const {
  query,
  setQuery,
  results,
  suggestions,
  loading,
  error,
  sortBy,
  setSortBy,
  search,
} = useSearch({ autoSearch: true, debounceMs: 300 })
```

功能：
- 自动搜索
- 防抖优化
- 状态管理
- 错误处理

### 搜索工具函数

#### 关键词高亮
```typescript
highlightKeywords(text: string, keywords: string): string
```

#### 摘要提取
```typescript
extractSearchSnippet(content: string, keywords: string, maxLength: number): string
```

#### 相关性计算
```typescript
calculateRelevanceScore(title: string, content: string, keywords: string): number
```

#### 搜索历史
```typescript
getSearchHistory(): SearchHistoryItem[]
addSearchHistory(query: string): void
clearSearchHistory(): void
```

### 数据库查询

使用Supabase的ilike操作符：
```typescript
await supabase
  .from('posts')
  .select('*')
  .eq('status', 'published')
  .or(`title.ilike.%${searchQuery}%,content.ilike.%${searchQuery}%`)
  .order('published_at', { ascending: false })
  .limit(50)
```

## 性能优化

### 防抖机制
- 搜索请求防抖300ms
- 减少不必要的数据库查询
- 提升用户体验

### 查询限制
- 搜索结果限制50条
- 搜索建议限制5条
- 搜索历史限制20条

### 缓存策略
- 搜索历史localStorage缓存
- 减少重复查询
- 快速访问历史搜索

## 最佳实践

### 用户体验
1. **快捷键优先**: 使用`Ctrl+K`快速搜索
2. **查看建议**: 利用搜索建议找到相关文章
3. **使用历史**: 重复搜索直接点击历史记录
4. **多关键词**: 使用多个关键词缩小范围
5. **切换排序**: 根据需求切换排序方式

### 开发集成
1. **保持简洁**: SearchBox组件轻量易用
2. **灵活配置**: 支持自定义placeholder、建议等
3. **响应式设计**: 完美支持移动端
4. **主题适配**: 深色/浅色主题完美切换

## 未来扩展

### 计划功能
- [ ] 搜索结果分页
- [ ] 高级筛选（按日期、标签、作者）
- [ ] 搜索统计分析
- [ ] 热门搜索词排行
- [ ] 搜索结果导出
- [ ] 全文索引优化
- [ ] 搜索联想词
- [ ] 相关文章推荐

### 性能提升
- [ ] 全文索引数据库优化
- [ ] 搜索结果缓存
- [ ] 增量搜索
- [ ] 并行查询优化

## 故障排除

### 搜索无结果
1. 检查关键词拼写
2. 尝试使用不同关键词
3. 检查数据库中是否有已发布文章
4. 查看浏览器控制台错误

### 搜索速度慢
1. 检查网络连接
2. 检查Supabase服务状态
3. 减少搜索关键词长度
4. 等待防抖延迟（300ms）

### 历史记录不保存
1. 检查浏览器localStorage是否启用
2. 检查是否在隐私/无痕模式
3. 清除浏览器缓存后重试

### 快捷键不工作
1. 检查是否与其他程序快捷键冲突
2. 尝试使用Cmd+K (Mac)或Ctrl+K (Windows)
3. 确保焦点在页面内

## 相关文档

- [CHANGELOG.md](./CHANGELOG.md) - 版本更新日志
- [README.md](./README.md) - 项目主文档
- [EDITOR_GUIDE.md](./EDITOR_GUIDE.md) - 编辑器使用指南
- [CODE_HIGHLIGHT_GUIDE.md](./CODE_HIGHLIGHT_GUIDE.md) - 代码高亮指南

## 支持

如果您在使用搜索功能时遇到问题：
1. 查看故障排除部分
2. 检查浏览器控制台错误
3. 联系技术支持：kvt97483@163.com

---

**版本**: v2.2.0  
**更新日期**: 2025-11-05  
**维护者**: MiniMax Agent
